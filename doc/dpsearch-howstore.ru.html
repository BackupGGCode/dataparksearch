<HTML
><HEAD
><TITLE
>Хранение данных</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.73
"><LINK
REL="HOME"
TITLE="DataparkSearch Engine 4.50"
HREF="index.ru.html"><LINK
REL="PREVIOUS"
TITLE="Шаблоны для индексирования"
HREF="dpsearch-htmlparser-bodypatterns.ru.html"><LINK
REL="NEXT"
TITLE="Способ хранения Cache

        "
HREF="dpsearch-cachemode.ru.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="datapark.css"><META
NAME="Description"
CONTENT="DataparkSearch - Полнофункциональная поисковая машина для Интернета и Интранета с открытым исходным кодом. Распространяется по лицензии GNU."><META
NAME="Keywords"
CONTENT="shareware, freeware, интернет, unix, поисковик, поисковая машина, поиск, поиск информации, интранет, open source, opensource, search, searching, software, udmsearch, engine, indexing, system, web, ftp, http, cgi, php, SQL, MySQL, database, php3, FreeBSD, Linux, Unix, DataparkSearch, MacOS X, Mac OS X, Windows, 2000, NT, 95, 98, GNU, GPL, url, grabbing"><SCRIPT
SRC="http://www.google-analytics.com/urchin.js"
TYPE="text/javascript"></SCRIPT><SCRIPT
SRC="http://www.dataparksearch.org/ga.js"
TYPE="text/javascript"></SCRIPT></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000C4"
VLINK="#1200B2"
ALINK="#C40000"
><!--#include virtual="body-before.html"--><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>DataparkSearch Engine 4.50: Справочное руководство</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="dpsearch-htmlparser-bodypatterns.ru.html"
ACCESSKEY="P"
>&#1055;&#1088;&#1077;&#1076;.</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="dpsearch-cachemode.ru.html"
ACCESSKEY="N"
>&#1057;&#1083;&#1077;&#1076;.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="howstore"
>&#1043;&#1083;&#1072;&#1074;&#1072; 5. Хранение данных</A
></H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>&#1057;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1085;&#1080;&#1077;</B
></DT
><DT
>5.1. <A
HREF="dpsearch-howstore.ru.html#sql-stor"
>SQL режимы хранения</A
></DT
><DT
>5.2. <A
HREF="dpsearch-cachemode.ru.html"
>Способ хранения Cache
<A
NAME="AEN2886"
></A
></A
></DT
><DT
>5.3. <A
HREF="dpsearch-perf.ru.html"
>К вопросу производительности <SPAN
CLASS="application"
>DataparkSearch</SPAN
>
<A
NAME="AEN3117"
></A
></A
></DT
><DT
>5.4. <A
HREF="dpsearch-searchd.ru.html"
>Поддержка SearchD
<A
NAME="AEN3213"
></A
></A
></DT
><DT
>5.5. <A
HREF="dpsearch-oracle.ru.html"
>Oracle notes
<A
NAME="AEN3297"
></A
></A
></DT
></DL
></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="sql-stor"
>5.1. SQL режимы хранения</A
></H1
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="sql-stor-general"
>5.1.1. Общая инфоромация о хранении</A
></H2
><P
><SPAN
CLASS="application"
>DataparkSearch</SPAN
> сохраняет в базе каждое найденное на страницах слово
вместе с номером секции документа, в которой найдено это слово, а также с номером позиции слова в документе. 
Число появлений каждого слова в документе не влияет на релевантность. Однако номер секции документа, в которой встречается слово,
может влиять на релевантность.
</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="sql-stor-modes"
>5.1.2. Разнообразные способы хранения слов</A
></H2
><P
>На данный момент <SPAN
CLASS="application"
>DataparkSearch</SPAN
> поддерживает следующие способы хранения слов
для SQL серверов:
"single", "multi", "crc", "crc-multi", "cache". Режимом по умолчанию является "cache". Способ задаётся параметром
 <TT
CLASS="option"
>dbmode</TT
> команды <B
CLASS="command"
>DBAddr</B
>, указываемой в файлах конфигурации
<TT
CLASS="filename"
>indexer.conf</TT
> и <TT
CLASS="filename"
>search.htm</TT
>.</P
><PRE
CLASS="programlisting"
>&#13;Примеры:
DBAddr mysql://localhost/search/?dbmode=single
DBAddr mysql://localhost/search/?dbmode=multi
DBAddr mysql://localhost/search/?dbmode=crc
DBAddr mysql://localhost/search/?dbmode=crc-multi
</PRE
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="sql-stor-single"
>5.1.3. Способ хранения single
                 <A
NAME="AEN2844"
></A
></A
></H2
><P
>Если указан режим хранения "single", все слова сохраняются в одной таблице (или текстовом файле, для
втсроенной базы данных) со структурой (url_id,word,weight), где url_id - идентификатор документа, равный значению поля rec_id
таблицы "url". Word имеет SQL тип <TT
CLASS="literal"
>variable char(32)</TT
>.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="sql-stor-multi"
>5.1.4. Способ хранения multi
                 <A
NAME="AEN2851"
></A
></A
></H2
><P
>Если выбран способ хранения "multi", слова будут сохранены в 13 различных таблицах, в зависимости от их длины.
Структура этих таблиц идентична структуре таблицы для способа хранения "single", только для Word используется тип char фиксированной длины,
что даёт выигрыш в скорости для большинства баз данных. Это делает режим "multi" более быстрым, по сравнению с "single".
Этот режим не реализован для встроенной базы данных.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="sql-stor-crc"
>5.1.5. Способ хранения crc
                 <A
NAME="AEN2857"
></A
></A
></H2
><P
>Если выбран способ хранения "crc", <SPAN
CLASS="application"
>DataparkSearch</SPAN
>
вместо слов будет сохранять их индентификатора, вычесленные как CRC32 сумма от этих слов.
Этот режим хранения использует меньше дискового пространства и работает быстрее способов хранения "single" и "multi".
Наши тесты показали, что только 250 пар слов из списка в 1.600.000 уникальных слов имеют одинаковую CRC32 сумму.
Большая часть этих пар (&#62;90%) содержит по меньшей мере одно слово с ошибкой. Инфоромация о каждом слове хранится в следующей
структуре (url_id,word_id,weight), где word_id - 32-битовый идентификатор слова, посчитаный как его CRC32 сумма.
Этот режим хранения рекомендуется для больших поисковиков.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="sql-stor-crcmulti"
>5.1.6. Способ хранения crc-multi
                 <A
NAME="AEN2864"
></A
></A
></H2
><P
>Если выбран способ хранения "crc-multi", <SPAN
CLASS="application"
>DataparkSearch</SPAN
>
хранит CRC32 идентификаторы  в нескольких таблицах (или двоичных файлах для встроенной базы данных) с такой же структурой, как и для
способа хранения "crc", и в зависимости от лины слова, как при режиме 
хранения "multi". Обычно это самый быстрый способ и рекомендован для больших поисковиков.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="sql-stor-structure"
>5.1.7. Замечание о стуктуре таблиц для SQL серверов</A
></H2
><P
>Учтите, что мы разрабатываем <SPAN
CLASS="application"
>DataparkSearch</SPAN
> с использованием
<SPAN
CLASS="application"
>PostgreSQL</SPAN
> в качестве SQL сервера и зачастую не имеем возможности тестировать каждую новую версию
со всеми поддерживаемыми базами данных. Т.е., если для вашей базы данных нет соответсвующей структуры таблиц в
директории <TT
CLASS="filename"
>create/you_database</TT
>, возьмите в качестве образца структуру для <SPAN
CLASS="application"
>PostgreSQL</SPAN
>
и создайте по аналогии структуру для вашей базы данных. Структура для <SPAN
CLASS="application"
>PostgreSQL</SPAN
>
всегда поддерживается в обновлённом состоянии.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="sql-stor-noncrc"
>5.1.8. Дополнительные возможности не-CRC режимов хранения</A
></H2
><P
>Режимы хранения <TT
CLASS="literal"
>single</TT
> и <TT
CLASS="literal"
>multi</TT
> поддерживают поиск подстрок. 
Т.к. при использовании режимов хранения <TT
CLASS="literal"
>crc</TT
> и <TT
CLASS="literal"
>crc-multi</TT
>
хранятся не слова сами по себе, а только их CRC-идентификаторы, то осуществить поиск подстрок не представляется возможным.</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="dpsearch-htmlparser-bodypatterns.ru.html"
ACCESSKEY="P"
>&#1055;&#1088;&#1077;&#1076;.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.ru.html"
ACCESSKEY="H"
>&#1053;&#1072;&#1095;&#1072;&#1083;&#1086;</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="dpsearch-cachemode.ru.html"
ACCESSKEY="N"
>&#1057;&#1083;&#1077;&#1076;.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Шаблоны для индексирования</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Способ хранения Cache
<A
NAME="AEN2886"
></A
></TD
></TR
></TABLE
></DIV
><!--#include virtual="body-after.html"--></BODY
></HTML
>