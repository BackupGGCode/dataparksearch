<HTML
><HEAD
><TITLE
>Хранение сжатых копий документов

</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.73
"><LINK
REL="HOME"
TITLE="DataparkSearch Engine 4.50"
HREF="index.ru.html"><LINK
REL="UP"
TITLE="Индексирование"
HREF="dpsearch-indexing.ru.html"><LINK
REL="PREVIOUS"
TITLE="Использование syslog"
HREF="dpsearch-syslog.ru.html"><LINK
REL="NEXT"
TITLE="HTML-парсер в DataparkSearch
"
HREF="dpsearch-htmlparser.ru.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="datapark.css"><META
NAME="Description"
CONTENT="DataparkSearch - Полнофункциональная поисковая машина для Интернета и Интранета с открытым исходным кодом. Распространяется по лицензии GNU."><META
NAME="Keywords"
CONTENT="shareware, freeware, интернет, unix, поисковик, поисковая машина, поиск, поиск информации, интранет, open source, opensource, search, searching, software, udmsearch, engine, indexing, system, web, ftp, http, cgi, php, SQL, MySQL, database, php3, FreeBSD, Linux, Unix, DataparkSearch, MacOS X, Mac OS X, Windows, 2000, NT, 95, 98, GNU, GPL, url, grabbing"><SCRIPT
SRC="http://www.google-analytics.com/urchin.js"
TYPE="text/javascript"></SCRIPT><SCRIPT
SRC="http://www.dataparksearch.org/ga.js"
TYPE="text/javascript"></SCRIPT></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000C4"
VLINK="#1200B2"
ALINK="#C40000"
><!--#include virtual="body-before.html"--><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>DataparkSearch Engine 4.50: Справочное руководство</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="dpsearch-syslog.ru.html"
ACCESSKEY="P"
>&#1055;&#1088;&#1077;&#1076;.</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>&#1043;&#1083;&#1072;&#1074;&#1072; 3. Индексирование</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="dpsearch-htmlparser.ru.html"
ACCESSKEY="N"
>&#1057;&#1083;&#1077;&#1076;.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="stored"
>3.13. Хранение сжатых копий документов
<A
NAME="AEN2515"
></A
></A
></H1
><P
><SPAN
CLASS="application"
>DataparkSearch</SPAN
> имеет возможность хранения сжатых копий проиндексированных документов.
Копии сжимаются и хранятся при помощи нового демона -
<B
CLASS="command"
>stored</B
>, который устанавливается в поддиректорию
<TT
CLASS="filename"
>sbin</TT
> корневой директории установки
<SPAN
CLASS="application"
>DataparkSearch</SPAN
> (по умолчанию:
<TT
CLASS="filename"
>/usr/local/dpsearch/sbin</TT
>).</P
><P
><A
NAME="AEN2524"
></A
>
<A
NAME="AEN2527"
></A
>
<B
CLASS="command"
>stored</B
>
может быть использован для создания цитат документов на основе слов из запроса.
<A
NAME="AEN2531"
></A
>
Для задания приблизительного размера цитаты в байтах, используйте в <TT
CLASS="filename"
>search.htm</TT
>
(в секции <TT
CLASS="literal"
>variables</TT
>) команду
<B
CLASS="command"
>ExcerptSize</B
>. Значение, используемое по умолчанию, равно 256.
Вы можете выключить создание цитат (но сохранив возможность показа сохраненных копий) документов указав команду <B
CLASS="command"
>DoExcerpt no</B
> в вашем поисковом шаблоне.
</P
><P
><A
NAME="AEN2539"
></A
>
В <SPAN
CLASS="application"
>DataparkSearch</SPAN
> можно хранить сжатые копии документов без
использования демона <B
CLASS="command"
>stored</B
>. Для этого вместо настройки параметров <B
CLASS="command"
>stored</B
>
в файле конфигурации <TT
CLASS="filename"
>indexer.conf</TT
> необходимо указать команду <B
CLASS="command"
>DoStore yes</B
>.
</P
><P
>Сохраненные копии документов отображаются отдельной CGI-программой
<TT
CLASS="filename"
>storedoc.cgi</TT
>. Эта программа получает сохранённую копию от
<B
CLASS="command"
>stored</B
> и отображает содержимое этого документа в окне броузера предварительно
выделив слова из поискового запроса.
</P
><P
> Для использования возможностей <B
CLASS="command"
>stored</B
>, 
скомпилируйте <SPAN
CLASS="application"
>DataparkSearch</SPAN
> с поддержкой <TT
CLASS="literal"
>zlib</TT
>:
	<PRE
CLASS="programlisting"
>&#13;./configure --with-zlib &#60;other arguments&#62;
</PRE
>
	</P
><P
>&#13;<A
NAME="AEN2556"
></A
>
<A
NAME="AEN2559"
></A
>
Вы можете использовать команды <B
CLASS="command"
>Store</B
> и <B
CLASS="command"
>NoStore</B
> для разрешения или запрещения сохранения
некоторых фалов по шаблону. Аргументы у этих команд точно такиеже, как и у команды <B
CLASS="command"
>Allow</B
> 
(см. <A
HREF="dpsearch-indexcmd.ru.html#allow_cmd"
>&#1056;&#1072;&#1079;&#1076;. 3.10.14</A
>). Все документы сохраняются по умолчанию, если включена поддержка stored.
</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="stored-start"
>3.13.1. Конфигурирование stored</A
></H2
><P
>Перед использованием <B
CLASS="command"
>stored</B
>, пожалуйста, проделпйте следующее:</P
><P
></P
><UL
><LI
><P
>Скопируйте <TT
CLASS="filename"
>/usr/local/dpsearch/etc/stored.conf-dist</TT
> в
<TT
CLASS="filename"
>/usr/local/dpsearch/etc/stored.conf</TT
>.</P
><P
>Отредактируйте <TT
CLASS="filename"
>/usr/local/dpsearch/etc/stored.conf</TT
>
				</P
><P
>Следующие команды используются для конфигурирования <B
CLASS="command"
>stored</B
>: </P
><P
></P
><UL
><LI
><P
>&#13;<B
CLASS="command"
><A
NAME="AEN2583"
></A
>Listen</B
>
говорит <B
CLASS="command"
>stored</B
> к какому адресу и/или порту привязаться.
По умолчанию, <B
CLASS="command"
>stored</B
> привязывается к порту 7004 и каждому адресу.
Возможно указывать только порт:</P
><P
>&#13;							<TT
CLASS="userinput"
><B
>Listen 7004 </B
></TT
>
						</P
><P
>Или только адрес:</P
><P
>&#13;							<TT
CLASS="userinput"
><B
>Listen 127.0.0.2</B
></TT
>
						</P
><P
>Или оба, алрес и порт:</P
><P
>&#13;							<TT
CLASS="userinput"
><B
>Listen 127.0.0.2:7004</B
></TT
>
						</P
></LI
><LI
><P
>&#13;<B
CLASS="command"
><A
NAME="AEN2599"
></A
>VarDir</B
>
задаёт альтернативную рабочую директорию <TT
CLASS="filename"
>var/</TT
>, например:</P
><P
>&#13;							<TT
CLASS="userinput"
><B
>VarDir /mnt/d/dpsearch/var/ </B
></TT
>
						</P
></LI
><LI
><P
><B
CLASS="command"
><A
NAME="AEN2608"
></A
>StoredFiles</B
>
указывает число файлов-хранилищ, создаваемых в директории <TT
CLASS="filename"
>var/stored/</TT
>, например:</P
><P
>&#13;<TT
CLASS="userinput"
><B
>StoredFiles 256</B
></TT
>
</P
></LI
><LI
><P
><B
CLASS="command"
><A
NAME="AEN2617"
></A
>OptimizeInterval</B
>
задаёт интервал в секундах между попытками оптимизировать очередной файл-хранилище, например:</P
><P
>&#13;<TT
CLASS="userinput"
><B
>OptimizeInterval 300</B
></TT
>
</P
></LI
><LI
><P
><B
CLASS="command"
><A
NAME="AEN2625"
></A
>OptimizeRatio</B
>
задаёт уровень дефрагментации в процентах, по достижении которого файл-хранилище оптимизируется, например:.  
</P
><P
>&#13;<TT
CLASS="userinput"
><B
>OptimizeRatio 3</B
></TT
>
</P
></LI
></UL
></LI
><LI
><P
>Запустите <B
CLASS="command"
>stored</B
>:</P
><P
>&#13;					<TT
CLASS="userinput"
><B
>/usr/local/dpsearch/sbin/stored &#38; </B
></TT
>
				</P
></LI
><LI
><P
>Отредактиируйте <TT
CLASS="filename"
>indexer.conf</TT
> и <TT
CLASS="filename"
>search.htm</TT
>
(или <TT
CLASS="filename"
>searchd.conf</TT
>, если используется <B
CLASS="command"
>searchd</B
>). Укажите адрес и порт, кроторые
<TT
CLASS="literal"
>indexer</TT
> будет использовать для связи с <B
CLASS="command"
>stored</B
>.
Используйте параметр <TT
CLASS="literal"
>stored</TT
> команды <B
CLASS="command"
>DBAddr</B
>,
например:</P
><P
>&#13;					<TT
CLASS="userinput"
><B
>DBAddr mysql://localhost/search/?dbmode=cache&#38;stored=localhost:7004</B
></TT
>
				</P
></LI
></UL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="stored-how"
>3.13.2. Как работает stored</A
></H2
><P
>После того, как вы сконфигурируете и запустите
<B
CLASS="command"
>stored</B
>, <TT
CLASS="filename"
>indexer</TT
> будет передавать ему проиндексированные документы.
А <B
CLASS="command"
>stored</B
> будет сжимать полученные документы и сохранять их на диске.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="stored-search"
>3.13.3. Использование stored при поиске</A
></H2
><P
>Для включения отображения сохраненных документов при поиске, проделайте следующее: </P
><P
></P
><UL
><LI
><P
>Отредактируйте
<TT
CLASS="filename"
>storedoc.htm</TT
> (шаблон для <TT
CLASS="filename"
>storedoc.cgi</TT
>), если необходимо.</P
></LI
><LI
><P
>Добавьте в секцию <TT
CLASS="literal"
>&#60;!--res--&#62;</TT
> шаблона
<TT
CLASS="filename"
>search.htm</TT
> ссылку на <TT
CLASS="filename"
>storedoc.cgi</TT
>, например:
 <TT
CLASS="literal"
>&#60;A HREF="$(stored_href)"&#62;Cached copy&#60;/A&#62; </TT
>
				</P
></LI
><LI
><P
>Укажите URL CGI-программы
<TT
CLASS="filename"
>storedoc.cgi</TT
> в
<TT
CLASS="filename"
>search.htm</TT
> (по умолчанию
<TT
CLASS="literal"
>$(stored_href)</TT
> будет возвращать
<TT
CLASS="filename"
>/cgi-bin/storedoc.cgi</TT
>). Если вам необходимо указать другой URL,
добавьте в раздел переменных шаблона <TT
CLASS="filename"
>search.htm</TT
>
					следующую строку:</P
><P
>&#13;					<TT
CLASS="userinput"
><B
>StoredocURL /path/to/storedoc.cgi</B
></TT
>
				</P
><P
>Или для абсолютной ссылки:</P
><P
>&#13;					<TT
CLASS="userinput"
><B
>StoredocURL http://servername/path/to/storedoc.cgi</B
></TT
>
				</P
></LI
></UL
><P
>Если все сконфигурировано правильно, при поиске <B
CLASS="command"
>stored</B
> работает следующим образом:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>&#13;					<TT
CLASS="filename"
>search.htm</TT
> показывает ссылку на <TT
CLASS="filename"
>storedoc.cgi</TT
>;</P
></LI
><LI
><P
>Когда пользователь кликает по ссылке,
<TT
CLASS="filename"
>storedoc.cgi</TT
> посылает запрос к демону
<B
CLASS="command"
>stored</B
> по адресу, указанному в
<TT
CLASS="filename"
>storedoc.htm</TT
> при помощи параметра <TT
CLASS="literal"
>stored</TT
> команды
<B
CLASS="command"
>DBAddr</B
>;</P
></LI
><LI
><P
>По этому запросу, <B
CLASS="command"
>stored</B
> находит и разжимает запрошенную копию и отправляет ее <TT
CLASS="filename"
>storedoc.cgi</TT
>;</P
></LI
><LI
><P
>&#13;					<TT
CLASS="filename"
>storedoc.cgi</TT
> разбирает полученный документ и выделяет все слова из поискового запроса. Способ выделения указывается в шаблоне <TT
CLASS="filename"
>storedoc.htm</TT
> командами
					<B
CLASS="command"
><A
NAME="AEN2702"
></A
>HlBeg</B
> and <B
CLASS="command"
><A
NAME="AEN2706"
></A
>HlEnd</B
>;</P
></LI
></OL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="dpsearch-syslog.ru.html"
ACCESSKEY="P"
>&#1055;&#1088;&#1077;&#1076;.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.ru.html"
ACCESSKEY="H"
>&#1053;&#1072;&#1095;&#1072;&#1083;&#1086;</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="dpsearch-htmlparser.ru.html"
ACCESSKEY="N"
>&#1057;&#1083;&#1077;&#1076;.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Использование syslog</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="dpsearch-indexing.ru.html"
ACCESSKEY="U"
>&#1059;&#1088;&#1086;&#1074;&#1077;&#1085;&#1100; &#1074;&#1099;&#1096;&#1077;</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>HTML-парсер в <SPAN
CLASS="application"
>DataparkSearch</SPAN
></TD
></TR
></TABLE
></DIV
><!--#include virtual="body-after.html"--></BODY
></HTML
>