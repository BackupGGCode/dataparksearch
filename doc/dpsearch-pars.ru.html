<HTML
><HEAD
><TITLE
>Внешние парсеры

</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.73
"><LINK
REL="HOME"
TITLE="DataparkSearch Engine 4.50"
HREF="index.ru.html"><LINK
REL="UP"
TITLE="Индексирование"
HREF="dpsearch-indexing.ru.html"><LINK
REL="PREVIOUS"
TITLE="ServerTable

"
HREF="dpsearch-srvtable.ru.html"><LINK
REL="NEXT"
TITLE="Остальные команды, используемые в indexer.conf"
HREF="dpsearch-indexcmd.ru.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="datapark.css"><META
NAME="Description"
CONTENT="DataparkSearch - Полнофункциональная поисковая машина для Интернета и Интранета с открытым исходным кодом. Распространяется по лицензии GNU."><META
NAME="Keywords"
CONTENT="shareware, freeware, интернет, unix, поисковик, поисковая машина, поиск, поиск информации, интранет, open source, opensource, search, searching, software, udmsearch, engine, indexing, system, web, ftp, http, cgi, php, SQL, MySQL, database, php3, FreeBSD, Linux, Unix, DataparkSearch, MacOS X, Mac OS X, Windows, 2000, NT, 95, 98, GNU, GPL, url, grabbing"><SCRIPT
SRC="http://www.google-analytics.com/urchin.js"
TYPE="text/javascript"></SCRIPT><SCRIPT
SRC="http://www.dataparksearch.org/ga.js"
TYPE="text/javascript"></SCRIPT></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000C4"
VLINK="#1200B2"
ALINK="#C40000"
><!--#include virtual="body-before.html"--><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>DataparkSearch Engine 4.50: Справочное руководство</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="dpsearch-srvtable.ru.html"
ACCESSKEY="P"
>&#1055;&#1088;&#1077;&#1076;.</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>&#1043;&#1083;&#1072;&#1074;&#1072; 3. Индексирование</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="dpsearch-indexcmd.ru.html"
ACCESSKEY="N"
>&#1057;&#1083;&#1077;&#1076;.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="pars"
>3.9. Внешние парсеры
<A
NAME="AEN1275"
></A
></A
></H1
><P
><SPAN
CLASS="application"
>DataparkSearch</SPAN
> <B
CLASS="command"
>indexer</B
> может использовать внешние парсеры для
различных типов файлов (mime types).</P
><P
>Парсер - это программа, которая конвертирует один из типов файла (mime type) в <TT
CLASS="literal"
>text/plain</TT
> или
<TT
CLASS="literal"
>text/html</TT
>. Например, если у вас есть PostScript файлы, Вы можете использовать парсер (фильтр)
<B
CLASS="command"
>ps2ascii</B
>, читающий из <TT
CLASS="literal"
>stdin</TT
> PostScript файл и выдающий текст в ascci на <TT
CLASS="literal"
>stdout</TT
>.
</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="pars-sup"
>3.9.1. Поддерживаемые типы парсеров</A
></H2
><P
><B
CLASS="command"
>Indexer</B
> поддерживает четыре типа парсеров, такие что:</P
><P
></P
><UL
><LI
><P
>читают данные из <TT
CLASS="literal"
>stdin</TT
> и выдают результат в <TT
CLASS="literal"
>stdout</TT
>;</P
></LI
><LI
><P
>читают данные из файла и выдают результат в <TT
CLASS="literal"
>stdout</TT
>;</P
></LI
><LI
><P
>читают данные из файла и помещают результат в файл;</P
></LI
><LI
><P
>читают данные из <TT
CLASS="literal"
>stdin</TT
> и помещают результат в файл.</P
></LI
></UL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="pars-setup"
>3.9.2. Установка парсеров</A
></H2
><P
></P
><OL
TYPE="1"
><LI
><P
>Конфигурирование типов файлов (mime types)</P
><P
>Сконфигурируйте Ваш веб-сервер на выдачу соответствующего заголовка
<TT
CLASS="literal"
>Content-Type</TT
>. Например, для <SPAN
CLASS="application"
>apache</SPAN
>, смотрите файл <TT
CLASS="filename"
>mime.types</TT
>,
большинство типов файлов уже указаны в нём.</P
><P
>&#13;<A
NAME="AEN1313"
></A
>
Если необходимо индексировать файлы на локальной файловой системе, или используя протокол <TT
CLASS="literal"
>ftp</TT
>
используйте команду <B
CLASS="command"
>AddType</B
> в
<TT
CLASS="filename"
>indexer.conf</TT
> для привязки типа файла к расширению файлов. Например:
				<PRE
CLASS="programlisting"
>&#13;AddType text/html *.html
</PRE
>
				</P
></LI
><LI
><P
>&#13;<A
NAME="AEN1322"
></A
>
Добавление парсеров</P
><P
>Добавление строк с определениями парсеров. Эти строки имеюют следующий формат с треми аргументами:
				<PRE
CLASS="programlisting"
>&#13;Mime &#60;from_mime&#62; &#60;to_mime&#62; &#60;command line&#62;
</PRE
>
				</P
><P
>Например, следующая строка определяет парсер для <SPAN
CLASS="application"
>man</SPAN
>-страниц:
				<PRE
CLASS="programlisting"
>&#13;# Use deroff for parsing man pages ( *.man )
Mime  application/x-troff-man   text/plain   deroff
</PRE
>
				</P
><P
>Этот парсер будет получать данные из <TT
CLASS="literal"
>stdin</TT
> и повещать результат в
<TT
CLASS="literal"
>stdout</TT
>.</P
><P
>Некоторые парсеры не могут работать с <TT
CLASS="literal"
>stdin</TT
>, а требуют указания имени
файла для чтения данных. В этом случае <B
CLASS="command"
>indexer</B
> создаёт временный файл в директории <TT
CLASS="filename"
>/tmp</TT
>,
который будет удалён после завершения работы парсера. Используйте макро <TT
CLASS="option"
>$1</TT
> в командной строке парсера вместо
требуемого имени файла. Например, команда <B
CLASS="command"
>Mime</B
>для конверотора <B
CLASS="command"
>catdoc</B
>, преобразующего файлы
<SPAN
CLASS="application"
>MS Word</SPAN
> в ascii может выглядеть так:
				<PRE
CLASS="programlisting"
>&#13;Mime application/msword text/plain "/usr/bin/catdoc -a $1"
</PRE
>
				</P
><P
>Если парсер записывает результат своей работы в файл, используйте макро <TT
CLASS="option"
>$2</TT
>.
<B
CLASS="command"
>indexer</B
> заменить <TT
CLASS="option"
>$2</TT
> на имя временного файла, запустит парсер, 
прочитает результат из этого временного файла, а затем удалит его. Например:
				<PRE
CLASS="programlisting"
>&#13;Mime application/msword text/plain "/usr/bin/catdoc -a $1 &#62;$2"
</PRE
>
				</P
><P
>Парсер выше будет читать данные из первого временного файла и записывать результат во
второй временный файл. Оба временных файла будут удалены по окончании  работы парсера. Заметим, что результат использования
этого парсера будет абсолютно таким же, как и предыдущего, они отличаютя только сопсобом выполнения: 
файл-&#62;<TT
CLASS="literal"
>stdout</TT
> и файл-&#62;файл соответственно.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="ParserTimeOut"
>3.9.3. Воизбежание зависания парсера при выполнении</A
></H2
><P
>&#13;<A
NAME="AEN1352"
></A
>
Воизбежание подвисания парсера при выполнении Вы можете указать в Вашем файле <TT
CLASS="filename"
>indexer.conf</TT
>
число времени в секундах, отводимое на работу парсеру, при помощи команды <TT
CLASS="literal"
>ParserTimeOut</TT
>. Напрмиер:
		<PRE
CLASS="programlisting"
>&#13;ParserTimeOut 600
</PRE
>
</P
><P
>&#13;Значение по умолчанию - 300 секунд, т.е. 5 минут.
</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="pars-pipes"
>3.9.4. Конвееры в командных строках парсеров</A
></H2
><P
>Вы можете использовать конвееры в командных строках парсеров. Например, следующие строки необходимы
 при индексировании загнузипленых страниц <SPAN
CLASS="application"
>man</SPAN
> на локальном диске:
		<PRE
CLASS="programlisting"
>&#13;AddType  application/x-gzipped-man  *.1.gz *.2.gz *.3.gz *.4.gz
Mime     application/x-gzipped-man  text/plain  "zcat | deroff"
</PRE
>
		</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="pars-char"
>3.9.5. Кодировки и парсеры
<A
NAME="AEN1366"
></A
></A
></H2
><P
>Некоторые парсеры могут выдавать результат в кодировке, отличной от указанной в
команда <B
CLASS="command"
>LocalCharset</B
>. Указание кодировки парсера даёт возможность <B
CLASS="command"
>indexer</B
>
перекодировать результат в нужную кодировку. Например, если <B
CLASS="command"
>catdoc</B
> сконфигурирован на вывод
результата в  windows-1251, а в <B
CLASS="command"
>LocalCharset</B
> указана кодировка koi8-r,
используйте следующую команду для парсера документов <SPAN
CLASS="application"
>MS Word</SPAN
>:
		<PRE
CLASS="programlisting"
>&#13;Mime  application/msword  "text/plain; charset=windows-1251" "catdoc -a $1"
</PRE
>
		</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="pars-udmurl"
>3.9.6. Переменная окружения DPS_URL
<A
NAME="AEN1378"
></A
></A
></H2
><P
>При выполнении парсера, <B
CLASS="command"
>indexer</B
> создаёт переменную окружения DPS_URL,
содержащую URL обрабатываемого документа. Вы можете использовать эту переменную в Ваших скриптах парсеров.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="pars-links"
>3.9.7. Некоторые внешние парсеры
<A
NAME="AEN1384"
></A
></A
></H2
><P
></P
><UL
><LI
><P
>RPM парсер от Mario Lang <TT
CLASS="email"
>&#60;<A
HREF="mailto:lang@zid.tu-graz.ac.at"
>lang@zid.tu-graz.ac.at</A
>&#62;</TT
></P
><P
>        /usr/local/bin/rpminfo:

<PRE
CLASS="programlisting"
>&#13;#!/bin/bash
/usr/bin/rpm -q --queryformat="&#60;html&#62;&#60;head&#62;&#60;title&#62;RPM: %{NAME} %{VERSION}-%{RELEASE}
(%{GROUP})&#60;/title&#62;&#60;meta name=\"description\" content=\"%{SUMMARY}\"&#62;&#60;/head&#62;&#60;body&#62;
%{DESCRIPTION}\n&#60;/body&#62;&#60;/html&#62;" -p $1
</PRE
>
</P
><P
>indexer.conf:
<PRE
CLASS="programlisting"
>&#13;Mime application/x-rpm text/html "/usr/local/bin/rpminfo $1"
</PRE
>
</P
><P
>Он даёт такую информацию об RPM:

<PRE
CLASS="programlisting"
>&#13;3. RPM: mysql 3.20.32a-3 (Applications/Databases) [4]
       Mysql is a SQL (Structured Query Language) database server.
       Mysql was written by Michael (monty) Widenius. See the CREDITS
       file in the distribution for more credits for mysql and related
       things....
       (application/x-rpm) 2088855 bytes
</PRE
>
</P
></LI
><LI
><P
>&#13;					<B
CLASS="command"
>catdoc</B
> конвертер <SPAN
CLASS="application"
>MS Word</SPAN
> в текст.
					<A
HREF="http://freshmeat.net/redir/catdoc/1055/url_homepage/"
TARGET="_top"
>Home page</A
>,
					также указан на <A
HREF="http://freshmeat.net/"
TARGET="_top"
>Freshmeat</A
>
					<PRE
CLASS="programlisting"
>indexer.conf: Mime application/msword  text/plain  "catdoc $1"</PRE
>
				</P
></LI
><LI
><P
>&#13;					<B
CLASS="command"
>xls2csv</B
> конвертор <SPAN
CLASS="application"
>MS Excel</SPAN
> в текст.
					Поставляется в пакете <B
CLASS="command"
>catdoc</B
>.
					<PRE
CLASS="programlisting"
>indexer.conf: Mime application/vnd.ms-excel text/plain "xls2csv $1"</PRE
>
				</P
></LI
><LI
><P
>&#13;					<B
CLASS="command"
>pdftotext</B
> конвертор <SPAN
CLASS="application"
>Adobe PDF</SPAN
> в текст.
					Поставляется в пакете <B
CLASS="command"
>xpdf</B
>.
					<A
HREF="http://freshmeat.net/redir/xpdf/12080/url_homepage/"
TARGET="_top"
>Homepage</A
>,
					также указан на <A
HREF="http://freshmeat.net/"
TARGET="_top"
>Freshmeat</A
>
					<PRE
CLASS="programlisting"
>indexer.conf: Mime application/pdf text/plain "pdftotext $1 -"</PRE
>
				</P
></LI
><LI
><P
>&#13;					<B
CLASS="command"
>unrtf</B
> конвертор RTF в html.
					<A
HREF="ftp://ftp.gnu.org/pub/gnu/unrtf/"
TARGET="_top"
>Homepage</A
>
<PRE
CLASS="programlisting"
>&#13;indexer.conf:
Mime text/rtf*        text/html "/usr/local/dpsearch/sbin/unrtf --html $1
Mime application/rtf  text/html "/usr/local/dpsearch/sbin/unrtf --html $1
</PRE
>
				</P
></LI
><LI
><P
><B
CLASS="command"
>xlhtml</B
> конверотор XLS в html</P
><P
>&#13;					<A
HREF="http://chicago.sourceforge.net/xlhtml/"
TARGET="_top"
>Homepage</A
>
</P
><P
><TT
CLASS="filename"
>indexer.conf</TT
>:
				<PRE
CLASS="programlisting"
>&#13;
Mime	application/vnd.ms-excel  text/html  "/usr/local/dpsearch/sbin/xlhtml $1"
</PRE
>
</P
></LI
><LI
><P
><B
CLASS="command"
>ppthtml</B
> Конвертор PowerPoint (PPT) в html. Часть проекта <SPAN
CLASS="application"
>xlhtml 0.5</SPAN
>.</P
><P
>&#13;					<A
HREF="http://chicago.sourceforge.net/xlhtml/"
TARGET="_top"
>Homepage</A
>
</P
><P
><TT
CLASS="filename"
>indexer.conf</TT
>:
				<PRE
CLASS="programlisting"
>&#13;
Mime	application/vnd.ms-powerpoint  text/html  "/usr/local/dpsearch/sbin/ppthtml $1"
</PRE
>
</P
></LI
><LI
><P
>Использование <A
HREF="http://wvWare.sourceforge.net/"
TARGET="_top"
>vwHtml</A
> Конвертор MS Word (DOC) в html.</P
><P
><TT
CLASS="filename"
>/usr/local/dpsearch/sbin/0vwHtml.pl</TT
>:
				<PRE
CLASS="programlisting"
>&#13;#!/usr/bin/perl -w

$p = $ARGV[1];
$f = $ARGV[1];

$p =~ s/(.*)\/([^\/]*)/$1\//;
$f =~ s/(.*)\/([^\/]*)/$2/;

system("/usr/local/bin/wvHtml --targetdir=$p $ARGV[0] $f");
</PRE
>
</P
><P
><TT
CLASS="filename"
>indexer.conf</TT
>:
				<PRE
CLASS="programlisting"
>&#13;
Mime  application/msword       text/html  "/usr/local/dpsearch/sbin/0wvHtml.pl $1 $2"
Mime  application/vnd.ms-word  text/html  "/usr/local/dpsearch/sbin/0wvHtml.pl $1 $2"
</PRE
>
</P
></LI
><LI
><P
><B
CLASS="command"
>swf2html</B
> из 
<A
HREF="http://www.macromedia.com/software/flash/download/search_engine/"
TARGET="_top"
>Flash Search Engine SDK</A
>
</P
><P
><TT
CLASS="filename"
>indexer.conf</TT
>:
				<PRE
CLASS="programlisting"
>&#13;
Mime  application/x-shockwave-flash  text/html  "/usr/local/dpsearch/sbin/swf2html $1"
</PRE
>
</P
></LI
><LI
><P
>djvutxt из 
<A
HREF="http://djvu.sourceforge.net/"
TARGET="_top"
>djvuLibre</A
>
</P
><P
><TT
CLASS="filename"
>indexer.conf</TT
>:
				<PRE
CLASS="programlisting"
>&#13;
Mime  image/djvu  text/plain  "/usr/local/bin/djvutxt $1 $2"
Mime  image/x.djvu  text/plain  "/usr/local/bin/djvutxt $1 $2"
Mime  image/x-djvu  text/plain  "/usr/local/bin/djvutxt $1 $2"
Mime  image/vnd.djvu  text/plain  "/usr/local/bin/djvutxt $1 $2"
</PRE
>
</P
></LI
></UL
><P
>Пожалуйста, присылайте Ваши скрипты и конфигурации для новых парсеров на адрес 
<TT
CLASS="email"
>&#60;<A
HREF="mailto:dataparksearch@datapark.ru"
>dataparksearch@datapark.ru</A
>&#62;</TT
>.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="dpsearch-srvtable.ru.html"
ACCESSKEY="P"
>&#1055;&#1088;&#1077;&#1076;.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.ru.html"
ACCESSKEY="H"
>&#1053;&#1072;&#1095;&#1072;&#1083;&#1086;</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="dpsearch-indexcmd.ru.html"
ACCESSKEY="N"
>&#1057;&#1083;&#1077;&#1076;.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>ServerTable
<A
NAME="AEN1230"
></A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="dpsearch-indexing.ru.html"
ACCESSKEY="U"
>&#1059;&#1088;&#1086;&#1074;&#1077;&#1085;&#1100; &#1074;&#1099;&#1096;&#1077;</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Остальные команды, используемые в <TT
CLASS="filename"
>indexer.conf</TT
></TD
></TR
></TABLE
></DIV
><!--#include virtual="body-after.html"--></BODY
></HTML
>