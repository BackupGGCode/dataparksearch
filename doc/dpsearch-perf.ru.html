<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>К вопросу производительности DataparkSearch

</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="DataparkSearch Engine 4.50"
HREF="index.ru.html"><LINK
REL="UP"
TITLE="Хранение данных"
HREF="dpsearch-howstore.ru.html"><LINK
REL="PREVIOUS"
TITLE="Способ хранения Cache

        "
HREF="dpsearch-cachemode.ru.html"><LINK
REL="NEXT"
TITLE="Поддержка SearchD

"
HREF="dpsearch-searchd.ru.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="datapark.css"><META
NAME="Description"
CONTENT="DataparkSearch - Полнофункциональная поисковая машина для Интернета и Интранета с открытым исходным кодом. Распространяется по лицензии GNU."><META
NAME="Keywords"
CONTENT="shareware, freeware, интернет, unix, поисковик, поисковая машина, поиск, поиск информации, интранет, open source, opensource, search, searching, software, udmsearch, engine, indexing, system, web, ftp, http, cgi, php, SQL, MySQL, database, php3, FreeBSD, Linux, Unix, DataparkSearch, MacOS X, Mac OS X, Windows, 2000, NT, 95, 98, GNU, GPL, url, grabbing"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000C4"
VLINK="#1200B2"
ALINK="#C40000"
><!--#include virtual="body-before.html"--><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>DataparkSearch Engine 4.50: Справочное руководство</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="dpsearch-cachemode.ru.html"
ACCESSKEY="P"
>&#1055;&#1088;&#1077;&#1076;.</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>&#1043;&#1083;&#1072;&#1074;&#1072; 5. Хранение данных</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="dpsearch-searchd.ru.html"
ACCESSKEY="N"
>&#1057;&#1083;&#1077;&#1076;.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="perf"
>5.3. К вопросу производительности <SPAN
CLASS="application"
>DataparkSearch</SPAN
>
<A
NAME="AEN3129"
></A
></A
></H1
>
	

<P
>Способ хранения cache - самый быстрый в <SPAN
CLASS="application"
>DataparkSearch</SPAN
>.
Используйте его, если хотите получить максимальную скорость поиска.
</P
>
<P
><A
NAME="AEN3134"
></A
>
Если после окончания индексирования содержимое вашей директории <TT
CLASS="filename"
>/var</TT
> не изменяется, вы можете
выключить блокировку файлов при открытиии используя команду <B
CLASS="command"
>"ColdVar yes"</B
> в файле <TT
CLASS="filename"
>search.htm</TT
>
(или в файле <TT
CLASS="filename"
>searchd.conf</TT
>, если используется <B
CLASS="command"
>searchd</B
>). Это позволит вам сэкономить некоторое время,
затрачиваемое на блокировку файлов.
</P
>


<DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="searchd-rec"
>5.3.1. Рекомендация использовать <B
CLASS="command"
>searchd</B
></A
></H2
>

<P
>Если вы планируете использовать синонимы, стоп-слова или данные ispell,
рекомендуется воспользоваться демоном <B
CLASS="command"
>searchd</B
> (См. ).
Демон <B
CLASS="command"
>searchd</B
> при запуске загружает эти данные и держит их в памяти.
Это позволяет сократить среднее время выполнения запросов на поиск.
</P
>
<P
>Таже <B
CLASS="command"
>searchd</B
> может загружать предварительно в память некоторые данные об URL 
(по 20 байт на каждую проиндекированую страницу) и лимиты cache mode (4 или 8 байт на каждый URL в зависимости от
типа лимита). Это позволяет сократить среднее время обработки запроса.
</P
>
</DIV
>

<DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="mfs-rec"
>5.3.2. Рекомендация использовать файловую систему в памяти (mfs)</A
></H2
>

<P
>Если вы планируете использовать cache mode и имеете достаточно оперативной памяти на вашем компьютере, 
вы можете разместить директорию <TT
CLASS="filename"
>/usr/local/dpsearch/var</TT
>
на файловой системе в памяти компьютера (mfs). Это ускорит как индексирование, так и поиск.
</P
>
<P
>Если памяти недостаточно, что поместить в ней <TT
CLASS="filename"
>/usr/local/dpsearch/var</TT
> целиком, 
вы можете разместить на mfs любую из директорий <TT
CLASS="filename"
>/usr/local/dpsearch/var/tree</TT
>,
<TT
CLASS="filename"
>/usr/local/dpsearch/var/url</TT
> или <TT
CLASS="filename"
>/usr/local/dpsearch/var/store</TT
>.
</P
>
</DIV
>

<DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="urlinfo-cmd"
>5.3.3. Команда URLInfoSQL</A
></H2
>

<A
NAME="AEN3162"
></A
>
<P
>Для способа хранения cache вы можете использовать команду <B
CLASS="command"
>URLInfoSQL no</B
> для выключения сохранения
информации об URL в SQL-базе. Однако использовав эту команду, вы потеряете возможность использовать лимиты по языку и типу документов.
</P
>
</DIV
>

<DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="markforindex-cmd"
>5.3.4. Команда MarkForIndex</A
></H2
>

<A
NAME="AEN3169"
></A
>
<P
>По умолчанию, <SPAN
CLASS="application"
>DataparkSearch</SPAN
> помечает все URL, отбираемые к индексированию, как ожидающие индексирования
через 4 часа. 
Это позволяет избежать возможного одновременного индексирования одно и того же URL двумя параллельно запущеными копиями indexer.
Однако для больших поисковых баз эта операция пометки может занять некоторое время. Вы можете выключить такую пометку используя команду
<B
CLASS="command"
>"MarkForIndex no"</B
> в вашем файле конфигурации <TT
CLASS="filename"
>indexer.conf</TT
>.
</P
>
</DIV
>


<DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="checkinsertsql-cmd"
>5.3.5. Команда <B
CLASS="command"
>CheckInsertSQL</B
></A
></H2
>

<A
NAME="AEN3179"
></A
>
<P
>По умолчанию, <SPAN
CLASS="application"
>DataparkSearch</SPAN
> пытается добавлять данные в SQL-базу вне зависимости, 
есть она уже там или нет. На некоторых системах, это может вызывать к дополнительной обработке сообщений об ошибках.
Чтобы избежать таких ошибок, Вы можете добавить команду <B
CLASS="command"
>CheckInsertSQL yes</B
> в ваш файл конфигурации
<TT
CLASS="filename"
>indexer.conf</TT
>.
</P
>
</DIV
>


	<DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="perf-mysql"
>5.3.6. Производительность <SPAN
CLASS="application"
>MySQL</SPAN
></A
></H2
>
		

		<P
>Пользователи <SPAN
CLASS="application"
>MySQL</SPAN
> могут задать
опцию <CODE
CLASS="option"
>DELAY_KEY_WRITE=1</CODE
> для таблиц <SPAN
CLASS="application"
>DataparkSearch</SPAN
>.
Это позволит быстрее обновлять индексы, т.к.они не будут записываться на диск пока файл не будет закрыт.
<CODE
CLASS="option"
>DELAY_KEY_WRITE</CODE
> целиком исключает обновление индексов на диске. </P
>

		<P
>С этой опцией индексы хранятся только в памяти и записываются на диск
в последнюю очередь, по команду  <B
CLASS="command"
>FLUSH TABLES</B
> или по завершению <B
CLASS="command"
>mysqld</B
>.
Запись одновлённых индексов на диск может занимать минуты и нетерпеливые пользователи могут прибить сервер
командой <TT
CLASS="literal"
>kill -9</TT
> и этим разрушить индексные файлы.
Другим неудобством является необходимость запуска <TT
CLASS="literal"
>myisamchk</TT
> для этих таблиц перед стартом
<B
CLASS="command"
>mysqld</B
> для проверки, на случай, если <TT
CLASS="literal"
>mysqld</TT
> был убит до этого.
</P
>

		<P
>По этим причинам мы не включили эту опцию в структуру наших таблиц по умолчанию.
Т.к. вся информация в индексах может быть восстановлена из данных, находящихся в таблицах, вы не потеряете данные,
используя опцию <CODE
CLASS="option"
>DELAY_KEY_WRITE</CODE
>. Но используйте её на свой страх и риск.
</P
>

	</DIV
>
	<DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="perf-optimization"
>5.3.7. Оптимизация после индексирования</A
></H2
>
		

		<P
>Этот раздел был добавлен Randy Winch <CODE
CLASS="email"
>&#60;<A
HREF="mailto:gumby@cafes.net"
>gumby@cafes.net</A
>&#62;</CODE
>
		</P
>

		<P
>У меня есть мысля о производителности, которая может заинтересовать некоторых из вас.
Я использую <TT
CLASS="literal"
>RH 6.2</TT
> с обновлением ядра <TT
CLASS="literal"
>2.2.14-6.1.1</TT
> (поддерживает файлы свыше 2 гигабайт)
и <TT
CLASS="literal"
>mysql 2.23.18-alpha</TT
>. Я проиндексировал весь наш сайт используя <SPAN
CLASS="application"
>mnoGoSearch 3.0.18</SPAN
>:
		<PRE
CLASS="programlisting"
>&#13;
          mnoGoSearch statistics

    Status    Expired      Total
   -----------------------------
       200     821178    2052579 OK
       301        797      29891 Moved Permanently
       302          3          3 Moved Temporarily
       304          0          7 Not Modified
       400          0         99 Bad Request
       403          0          7 Forbidden
       404      30690     100115 Not found
       500          0          1 Internal Server Error
       503          0          1 Service Unavailable
   -----------------------------
     Total     852668    2182703

</PRE
>
</P
>

		<P
>Я оптимизировал данные, выгрузив их в файл используя <CODE
CLASS="option"
>SELECT * INTO OUTFILE</CODE
>,
отсортировал их при помощи системной процедуры сортировки по полю <TT
CLASS="literal"
>word (CRC)</TT
>
и затем загрузил их обратно в базу данных, используя процедуру, описанную в 
<A
HREF="http://www.mysql.com/documentation/mysql/commented/manual.php?section=Insert_speed"
TARGET="_top"
>mysql online manual</A
>.</P
>

		<P
>Производительность великолепна. Мой любимый тест - поиск "John Smith".
Оптимизированная база показала результат в 13 секунд. База до оптимизации показывала примерно 73 секунды.</P
>

		<PRE
CLASS="programlisting"
>&#13;Search results: john : 620241 smith : 177096
Displaying documents 1-20 of total 128656 found
</PRE
>

		

	</DIV
>

<DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="ares"
>5.3.8. Библиотека асинхронного резолвера</A
></H2
>

<P
>Использование <A
HREF="ftp://athena-dist.mit.edu/pub/ATHENA/ares/"
TARGET="_top"
>ares</A
>, 
библиотеки асинхронного резолвера (dns/ares в коллекции портов FreeBSD), позволяет для каждой индексирующей нити выполнять 
запросы к DNS без блокировки. Пожалуйста учтите, это также повышает число одновременных запросов к вашему DNS серверу.
</P
>
</DIV
>

</DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="dpsearch-cachemode.ru.html"
ACCESSKEY="P"
>&#1055;&#1088;&#1077;&#1076;.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.ru.html"
ACCESSKEY="H"
>&#1053;&#1072;&#1095;&#1072;&#1083;&#1086;</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="dpsearch-searchd.ru.html"
ACCESSKEY="N"
>&#1057;&#1083;&#1077;&#1076;.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Способ хранения Cache
<A
NAME="AEN2898"
></A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="dpsearch-howstore.ru.html"
ACCESSKEY="U"
>&#1059;&#1088;&#1086;&#1074;&#1077;&#1085;&#1100; &#1074;&#1099;&#1096;&#1077;</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Поддержка SearchD
<A
NAME="AEN3225"
></A
></TD
></TR
></TABLE
></DIV
><!--#include virtual="body-after.html"--></BODY
></HTML
>